{% extends 'configmanager/__base__.html' %}
{% block title %}发布申请详情 | {% endblock %}
{% block content %}
<h2>发布管理 > 发布申请详情</h2>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<script type="text/javascript">
function insRow()
  {
  var x=document.getElementById('idd_deployitem').insertRow(-1)
  var y0=x.insertCell(0)
  var y1=x.insertCell(1)
  y0.innerHTML='<input type="number" name="deployitem_orderby" min="0">'
  y1.innerHTML='<input type="number" name="deployitem_jenkinsversion" min="0">'
  }
</script>

<form action="{% url 'configmanager:applysave' apply.id %}" method="post">
{{ apply_form.management_form }}
{{ deployitem_form.management_form }}
{% csrf_token %}
<table>
    <tbody>
        <tr>
            <th>申请编号</th>
            <td>{{ apply.applyproject }}</td>
        </tr>
        <tr>
            <th>期望发布时间</th>
            <td>{{ apply_form.wishdeploy_time }}</td>
        </tr>
        <tr>
            <th>选择发布站点</th>
            <td>
                <table id="idd_deployitem">
                    <thead>
                        <tr>
                            {% for form in deployitem_form %}
                                {% if forloop.first %}
                                    {% for field in form %}
                                        {% if field.label != "Id" and field.label != "Applyproject" %}
                                            <th>{{ field.label }}</th>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody id="id_deployitem_tbody">
                        {% for form in deployitem_form %}
                            <tr>
                                {% for field in form %}
                                    <td>{{ field }}</td>
                                {% endfor %}
                            </tr>
                        {% endfor %}
                        <tr class="add-row"><td colspan="7"><a href="#" onclick="insRow()">添加另一个 发布站点</a></td></tr>
                    </tbody>
                </table>
           </td>
        </tr>
        <tr>
            <th valign="top">配置修改说明</th>
            <td>
                {{ apply_form.confamendexplain }}
            </td>
        </tr>
        <tr>
            <th valign="top">备注事项</th>
            <td>
                {{ apply_form.remarkexplain }}
            </td>
        </tr>
        <tr>
            <th>状态</th>
            <td name="deploystatus"> 
                {% if apply.status == "WC" %}
                    <span>待提交</span>
                {% elif apply.status == "WD" %}
                    <span>待发布</span>
                {% elif apply.status == "C" %}
                    <span>已取消</span>
                {% elif apply.status == "D" %}
                    <span>已发布</span>
                {% elif apply.status == "DA" %}
                    <span>研发经理审批中</span>
                {% elif apply.status == "OA" %}
                    <span>运维经理审批中</span>
                {% elif apply.status == "EA" %}
                    <span>运维工程师审批中</span>
                {% elif apply.status == "TA" %}
                    <span>测试经理审批中</span>
                {% elif apply.status == "TDA" %}
                    <span>技术总监审批中</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>申请人</th>
            <td>
                {{ apply.apply_user }}
            </td>
        </tr>
        <tr>
            <th>申请时间</th>
            <td>
                {{ apply.apply_time }}
            </td>
        </tr>
        <tr>
            <th>展开操作日志</th>
            <td>
            </td>
        </tr>
    </tbody>
</table>
<input type="submit" name="apply-save"value="保存" />
<input type="button" name="goback" value="返回" onclick='location.href=("/apply")'/>
</form>

{% endblock %}
