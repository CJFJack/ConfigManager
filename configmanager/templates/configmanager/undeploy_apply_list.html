{% extends 'configmanager/__base__.html' %}
{% block title %}发布申请列表 | {% endblock %}
{% block content %}
{% load systemmanager %}
<h2>发布管理 > 待发布申请列表</h2>
{% if apply_list %}
<table border="1">
    <th>申请编号</th>
    <th>状态</th>
    <th>申请人</th>
    <th>申请时间</th>
    <th>期望发布时间</th>
    <th>发布人</th>
    <th>实际发布时间</th>
    <th>操作</th>
    {% for apply in apply_list %}
    <tr>
        <td>
            <a href="{% url 'configmanager:applychange' apply.id %}">{{ apply.applyproject }}</a>
        </td>
        <td>
            {% if apply.status == "WC" %}
                <span>待提交</span>
            {% elif apply.status == "WD" %}
                <span>待发布</span>
            {% elif apply.status == "C" %}
                <span>已取消</span>
            {% elif apply.status == "D" %}
                <span>已发布</span>
            {% elif apply.status == "DA" %}
                <span>研发经理审批中</span>
            {% elif apply.status == "OA" %}
                <span>运维经理审批中</span>
            {% elif apply.status == "EA" %}
                <span>运维工程师审批中</span>
            {% elif apply.status == "TA" %}
                <span>测试经理审批中</span>
            {% elif apply.status == "TDA" %}
                <span>技术总监审批中</span>
            {% endif %}
        </td>
        <td>
            {{ apply.apply_user }}
        </td>
        <td>
            {{ apply.apply_time }}
        </td>
        <td>
            {% if apply.wishdeploy_time is null %}
            {% else %}
                {{ apply.wishdeploy_time }}
            {% endif %}
        </td>
        <td>
            {% if apply.deploy_user is null %}
            {% else %}
                {{ apply.deploy_user }}
            {% endif %}
        </td>
        <td>
            {% if apply.deploy_time is null %}
            {% else %}
                {{ apply.deploy_time }}
            {% endif %}
        </td>
        <td align="right">
            <a href={% url 'configmanager:applychange' apply.id %}><span {% if apply.status != "WC" %}style="display:none"{% endif %}>修改</span></a>
            {% if request.user|has_group:"运维工程师" or request.user|has_group:"admin" %}
            <a href={% url 'configmanager:deploysitelist' apply.id %}><span {% if apply.status != "WD" %}style="display:none"{% endif %}>现在去发布</span></a>
            {% endif %}
            {% if request.user|has_group:"admin"%}
            <a href={% url 'configmanager:applydelete' apply.id %} onclick="return confirm('Are you sure you want to delete this?')">删除</a>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
    <p>No apply are available.</p>
{% endif %}
{% endblock %}
